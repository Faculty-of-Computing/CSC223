<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CSC 223 Quiz</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app"></div>
  <script src="quiz.js"></script>
  <script>
    const quiz = typeof module !== "undefined" ? require("./quiz") : window.quiz;

    function renderQuestion(index) {
      const question = quiz.questions[index];
      const answers = question.responses
        .map((r, i) => `<button class="option" onclick="selectOption(${i})">${String.fromCharCode(97 + i)}. ${r.text}</button>`) // a., b., etc.
        .join("<br>");

      document.getElementById("app").innerHTML = `
        <div class="quiz-container">
          <h2>${index + 1}. ${question.text}</h2>
          <div class="options">${answers}</div>
          <div class="nav-buttons">
            ${index > 0 ? '<button onclick="prevQuestion()">Previous</button>' : ""}
            <button onclick="nextQuestion()">${index < quiz.questions.length - 1 ? "Next" : "Submit"}</button>
          </div>
          <div class="progress">
            ${index + 1} / ${quiz.questions.length}
          </div>
        </div>
      `;
    }

    let current = 0;
    let answers = Array(quiz.questions.length).fill(null);

    function selectOption(i) {
      answers[current] = i;
    }

    function prevQuestion() {
      if (current > 0) {
        current--;
        renderQuestion(current);
      }
    }

    function nextQuestion() {
      if (current < quiz.questions.length - 1) {
        current++;
        renderQuestion(current);
      } else {
        showResult();
      }
    }

    function showResult() {
      let score = 0;
      quiz.questions.forEach((q, i) => {
        if (q.responses[answers[i]] && q.responses[answers[i]].correct) {
          score++;
        }
      });
      const name = localStorage.getItem("quizUser") || "User";
      document.getElementById("app").innerHTML = `
        <div class="result-screen">
          <h2>Quiz Completed</h2>
          <p>Well done, <strong>${name}</strong>!</p>
          <p>Your score: ${score} / ${quiz.questions.length}</p>
        </div>
      `;
    }

    window.onload = function () {
      renderQuestion(current);
    };
  </script>
</body>
</html>
